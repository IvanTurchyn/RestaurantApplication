{"ast":null,"code":"import { switchMap, throwError } from \"rxjs\";\nimport { catchError } from 'rxjs/operators';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"./auth/auth.service\";\nimport * as i2 from \"@angular/router\";\nclass AuthInterceptorService {\n  constructor(authService, router) {\n    this.authService = authService;\n    this.router = router;\n  }\n  intercept(req, next) {\n    const token = this.authService.getToken();\n    if (token) {\n      req = req.clone({\n        setHeaders: {\n          Authorization: `Bearer ${token}`\n        }\n      });\n    }\n    return next.handle(req).pipe(catchError(error => {\n      if (error.status === 401) {\n        return this.authService.refreshToken().pipe(switchMap(() => {\n          return next.handle(req);\n        }), catchError(refreshError => {\n          this.authService.logout();\n          this.router.navigateByUrl('/login').catch(() => {});\n          return throwError(refreshError);\n        }));\n      } else {\n        return throwError(error);\n      }\n    }));\n  }\n}\nAuthInterceptorService.ɵfac = function AuthInterceptorService_Factory(t) {\n  return new (t || AuthInterceptorService)(i0.ɵɵinject(i1.AuthService), i0.ɵɵinject(i2.Router));\n};\nAuthInterceptorService.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n  token: AuthInterceptorService,\n  factory: AuthInterceptorService.ɵfac\n});\nexport { AuthInterceptorService };","map":{"version":3,"names":["switchMap","throwError","catchError","AuthInterceptorService","constructor","authService","router","intercept","req","next","token","getToken","clone","setHeaders","Authorization","handle","pipe","error","status","refreshToken","refreshError","logout","navigateByUrl","catch","i0","ɵɵinject","i1","AuthService","i2","Router","factory","ɵfac"],"sources":["D:\\Записи занятий ClickMeeteeng\\Desktop\\Inzeneria oprogramowania\\Cwiczenia\\RestaurantApplication\\frontend\\restaurant-app\\src\\app\\auth-interceptor.service.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\nimport {HttpErrorResponse, HttpEvent, HttpHandler, HttpInterceptor, HttpRequest} from \"@angular/common/http\";\nimport {AuthService} from \"./auth/auth.service\";\nimport {Observable, switchMap, throwError} from \"rxjs\";\nimport {Router} from \"@angular/router\";\nimport { catchError } from 'rxjs/operators';\n\n@Injectable()\nexport class AuthInterceptorService implements HttpInterceptor {\n\n  constructor(private authService: AuthService, private router: Router) {}\n\n  intercept(req: HttpRequest<any>, next: HttpHandler): Observable<HttpEvent<any>> {\n    const token = this.authService.getToken();\n\n    if (token) {\n      req = req.clone({\n        setHeaders: {\n          Authorization: `Bearer ${token}`\n        }\n      });\n    }\n\n    return next.handle(req).pipe(\n      catchError((error: HttpErrorResponse) => {\n        if (error.status === 401) {\n          return this.authService.refreshToken().pipe(\n            switchMap(() => {\n              return next.handle(req);\n            }),\n            catchError((refreshError: HttpErrorResponse) => {\n              this.authService.logout();\n              this.router.navigateByUrl('/login').catch(() => {});\n              return throwError(refreshError);\n            })\n          );\n        } else {\n          return throwError(error);\n        }\n      })\n    );\n  }\n}\n"],"mappings":"AAGA,SAAoBA,SAAS,EAAEC,UAAU,QAAO,MAAM;AAEtD,SAASC,UAAU,QAAQ,gBAAgB;;;;AAE3C,MACaC,sBAAsB;EAEjCC,YAAoBC,WAAwB,EAAUC,MAAc;IAAhD,KAAAD,WAAW,GAAXA,WAAW;IAAuB,KAAAC,MAAM,GAANA,MAAM;EAAW;EAEvEC,SAASA,CAACC,GAAqB,EAAEC,IAAiB;IAChD,MAAMC,KAAK,GAAG,IAAI,CAACL,WAAW,CAACM,QAAQ,EAAE;IAEzC,IAAID,KAAK,EAAE;MACTF,GAAG,GAAGA,GAAG,CAACI,KAAK,CAAC;QACdC,UAAU,EAAE;UACVC,aAAa,EAAE,UAAUJ,KAAK;;OAEjC,CAAC;;IAGJ,OAAOD,IAAI,CAACM,MAAM,CAACP,GAAG,CAAC,CAACQ,IAAI,CAC1Bd,UAAU,CAAEe,KAAwB,IAAI;MACtC,IAAIA,KAAK,CAACC,MAAM,KAAK,GAAG,EAAE;QACxB,OAAO,IAAI,CAACb,WAAW,CAACc,YAAY,EAAE,CAACH,IAAI,CACzChB,SAAS,CAAC,MAAK;UACb,OAAOS,IAAI,CAACM,MAAM,CAACP,GAAG,CAAC;QACzB,CAAC,CAAC,EACFN,UAAU,CAAEkB,YAA+B,IAAI;UAC7C,IAAI,CAACf,WAAW,CAACgB,MAAM,EAAE;UACzB,IAAI,CAACf,MAAM,CAACgB,aAAa,CAAC,QAAQ,CAAC,CAACC,KAAK,CAAC,MAAK,CAAE,CAAC,CAAC;UACnD,OAAOtB,UAAU,CAACmB,YAAY,CAAC;QACjC,CAAC,CAAC,CACH;OACF,MAAM;QACL,OAAOnB,UAAU,CAACgB,KAAK,CAAC;;IAE5B,CAAC,CAAC,CACH;EACH;;AAjCWd,sBAAsB,C;mBAAtBA,sBAAsB,EAAAqB,EAAA,CAAAC,QAAA,CAAAC,EAAA,CAAAC,WAAA,GAAAH,EAAA,CAAAC,QAAA,CAAAG,EAAA,CAAAC,MAAA;AAAA;AAAtB1B,sBAAsB,C;SAAtBA,sBAAsB;EAAA2B,OAAA,EAAtB3B,sBAAsB,CAAA4B;AAAA;SAAtB5B,sBAAsB"},"metadata":{},"sourceType":"module","externalDependencies":[]}